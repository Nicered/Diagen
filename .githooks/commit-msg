#!/bin/bash

# Commit message validation hook

COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Colors
RED='\033[0;31m'
NC='\033[0m' # No Color

error() {
    echo -e "${RED}β μ»¤λ°‹ λ©”μ‹μ§€ μ¤λ¥${NC}"
    echo ""
    echo "$1"
    exit 1
}

# Check for Claude signature
if echo "$COMMIT_MSG" | grep -qE "(π¤– Generated with \[Claude|Co-Authored-By: Claude)"; then
    error "ν΄λ΅λ“ μ„λ…μ΄ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤.
λ‹¤μ λ‚΄μ©μ„ μ κ±°ν•΄μ£Όμ„Έμ”:
  - π¤– Generated with [Claude Code]
  - Co-Authored-By: Claude"
fi

# Count bullet points (lines starting with - or *)
BULLET_COUNT=$(echo "$COMMIT_MSG" | grep -cE "^[[:space:]]*[-*]")
MAX_BULLETS=4

if [ "$BULLET_COUNT" -gt "$MAX_BULLETS" ]; then
    error "λ¶λ¦Ώ ν¬μΈνΈκ°€ ${MAX_BULLETS}κ°λ¥Ό μ΄κ³Όν•©λ‹λ‹¤.
ν„μ¬ λ¶λ¦Ώ κ°μ: ${BULLET_COUNT}
μµλ€ ν—μ©: ${MAX_BULLETS}κ°"
fi

exit 0
